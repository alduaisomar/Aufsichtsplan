<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enhanced PrÃ¼fungsaufsichtsplan</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary-orange: #ff8c00;
        --primary-blue: #1e90ff;
        --secondary-orange: #ffb84d;
        --secondary-blue: #4169e1;
        --accent-orange: #ff7518;
        --accent-blue: #0066cc;
        --gradient-primary: linear-gradient(
          135deg,
          var(--primary-orange),
          var(--primary-blue)
        );
        --gradient-card: linear-gradient(145deg, #ffffff, #f8f9ff);
        --shadow-card: 0 8px 32px rgba(30, 144, 255, 0.1);
        --text-primary: #2c3e50;
        --text-secondary: #64748b;
        --success: #10b981;
        --warning: #f59e0b;
        --error: #ef4444;
        --border-light: #e2e8f0;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: var(--gradient-primary);
        min-height: 100vh;
        color: var(--text-primary);
        padding-top: 60px;
        overflow-x: hidden;
      }

      /* Enhanced Ticker Banner */

      .ticker-banner {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 50px;
        background: linear-gradient(
          135deg,
          rgba(255, 140, 0, 0.95),
          rgba(30, 136, 229, 0.95)
        );
        backdrop-filter: blur(15px);
        z-index: 1000;
        overflow: hidden; /* Crucial for the seamless effect */
        border-bottom: 3px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        display: flex; /* Added to help align content */
      }

      .ticker-content {
        display: flex;
        align-items: center;
        height: 100%;
        white-space: nowrap;
        /* The animation now creates a seamless loop */
        animation: scroll-left 40s linear infinite;
        color: white;
        font-size: 15px;
        font-weight: 600;
        letter-spacing: 0.8px;
      }

      .ticker-content:hover {
        animation-play-state: paused;
      }

      /* We create a wrapper for each set of items to ensure correct spacing */
      .ticker-content > span {
        display: inline-flex;
        align-items: center;
      }

      .ticker-item {
        margin: 0 40px; /* Use margin for spacing instead of just margin-right */
        display: inline-flex;
        align-items: center;
        gap: 10px;
        background: rgba(255, 255, 255, 0.1);
        padding: 8px 16px;
        border-radius: 25px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .ticker-rank {
        font-size: 18px;
        margin-right: 6px;
      }

      .ticker-names {
        font-weight: 700;
      }

      .ticker-count {
        background: rgba(255, 255, 255, 0.3);
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 12px;
        margin-left: 10px;
      }
      @keyframes scroll-left {
        0% {
          transform: translateX(0);
        }
        100% {
          /* We scroll by -50% because the JS duplicates the content. This creates the seamless loop. */
          transform: translateX(-50%);
        }
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      /* Enhanced Header */
      .header {
        margin-bottom: 40px;
        color: white;
        text-align: center;
        position: relative;
      }

      .header-content {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 40px;
        border: 2px solid rgba(255, 255, 255, 0.2);
      }

      .header h1 {
        font-size: 3.5rem;
        margin-bottom: 15px;
        text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
        background: linear-gradient(45deg, #fff, #f0f8ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .header p {
        font-size: 1.3rem;
        opacity: 0.95;
        max-width: 800px;
        margin: 0 auto;
        line-height: 1.6;
      }

      /* Control Panel */
      .control-panel {
        background: white;
        border-radius: 20px;
        box-shadow: var(--shadow-card);
        margin-bottom: 30px;
        overflow: hidden;
      }

      .control-header {
        background: var(--gradient-primary);
        color: white;
        padding: 20px 30px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 15px;
      }

      .control-title {
        font-size: 1.4rem;
        font-weight: bold;
      }

      .view-toggle {
        display: flex;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 15px;
        padding: 5px;
        gap: 5px;
      }

      .view-btn {
        background: transparent;
        border: none;
        color: white;
        padding: 8px 16px;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.9rem;
      }

      .view-btn.active {
        background: rgba(255, 255, 255, 0.3);
      }

      .control-content {
        padding: 30px;
      }

      /* Enhanced Search */
      .search-section {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 20px;
        margin-bottom: 20px;
        align-items: start;
      }

      .search-box {
        position: relative;
      }

      #searchInput {
        width: 100%;
        padding: 18px 50px 18px 20px;
        font-size: 1.2rem;
        border: 3px solid var(--border-light);
        border-radius: 15px;
        outline: none;
        transition: all 0.3s ease;
        background: #fafbfc;
      }

      #searchInput:focus {
        border-color: var(--primary-orange);
        box-shadow: 0 0 0 4px rgba(255, 140, 0, 0.1);
        background: white;
      }

      .search-icon {
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-secondary);
        font-size: 1.4rem;
      }

      .autocomplete-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 2px solid var(--border-light);
        border-top: none;
        border-radius: 0 0 15px 15px;
        max-height: 300px;
        overflow-y: auto;
        z-index: 100;
        box-shadow: var(--shadow-card);
      }

      .autocomplete-item {
        padding: 12px 20px;
        cursor: pointer;
        transition: background 0.2s ease;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .autocomplete-item:hover,
      .autocomplete-item.selected {
        background: #f1f5f9;
      }

      /* Quick Actions */
      .quick-actions {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .action-btn {
        background: var(--gradient-primary);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        white-space: nowrap;
      }

      .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      }

      .action-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      /* Advanced Filters */
      .filters-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .filter-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .filter-label {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 0.9rem;
      }

      .filter-select,
      .filter-input {
        padding: 10px 12px;
        border: 2px solid var(--border-light);
        border-radius: 10px;
        font-size: 0.9rem;
        background: white;
        transition: border-color 0.3s ease;
      }

      .filter-select:focus,
      .filter-input:focus {
        outline: none;
        border-color: var(--primary-blue);
      }

      /* Statistics Dashboard */
      .stats-dashboard {
        background: white;
        border-radius: 20px;
        box-shadow: var(--shadow-card);
        margin-bottom: 30px;
        overflow: hidden;
      }

      .stats-header {
        background: var(--gradient-primary);
        color: white;
        padding: 20px 30px;
        text-align: center;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        padding: 30px;
      }

      .stat-card {
        background: var(--gradient-card);
        border-radius: 15px;
        padding: 25px;
        text-align: center;
        border: 2px solid var(--border-light);
        transition: all 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-card);
      }

      .stat-icon {
        font-size: 3rem;
        margin-bottom: 15px;
      }

      .stat-value {
        font-size: 2.5rem;
        font-weight: bold;
        color: var(--primary-orange);
        margin-bottom: 5px;
      }

      .stat-label {
        color: var(--text-secondary);
        font-weight: 600;
      }

      /* Chart Container */
      .chart-container {
        background: white;
        border-radius: 20px;
        box-shadow: var(--shadow-card);
        padding: 30px;
        margin-bottom: 30px;
      }

      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 15px;
      }

      .chart-title {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--text-primary);
      }

      .chart-tabs {
        display: flex;
        background: #f1f5f9;
        border-radius: 12px;
        padding: 4px;
      }

      .chart-tab {
        background: transparent;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
      }

      .chart-tab.active {
        background: white;
        color: var(--primary-blue);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      /* Enhanced Results */
      .results-container {
        background: white;
        border-radius: 20px;
        box-shadow: var(--shadow-card);
        overflow: hidden;
      }

      .results-header {
        background: var(--gradient-primary);
        color: white;
        padding: 25px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
      }

      .results-info {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .results-count {
        font-size: 1.3rem;
        font-weight: bold;
      }

      .results-meta {
        background: rgba(255, 255, 255, 0.2);
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.9rem;
      }

      .results-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      /* Card View */
      .results-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 25px;
        padding: 30px;
      }

      .proctor-card {
        background: var(--gradient-card);
        border-radius: 15px;
        padding: 25px;
        border: 2px solid var(--border-light);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .proctor-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-card);
        border-color: var(--primary-orange);
      }

      .proctor-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 20px;
      }

      .proctor-name {
        font-size: 1.3rem;
        font-weight: bold;
        color: var(--text-primary);
        margin-bottom: 5px;
      }

      .proctor-initials {
        background: var(--gradient-primary);
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1.2rem;
      }

      /* Enhanced Load Indicator */
      .load-indicator {
        background: #f8fafc;
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 20px;
        border: 2px solid var(--border-light);
      }

      .load-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .load-title {
        font-weight: 600;
        color: var(--text-primary);
      }

      .load-percentage {
        font-weight: bold;
        font-size: 1.1rem;
      }

      .load-bar {
        height: 12px;
        background: #e2e8f0;
        border-radius: 6px;
        overflow: hidden;
        margin-bottom: 8px;
      }

      .load-fill {
        height: 100%;
        transition: width 0.6s ease;
        border-radius: 6px;
      }

      .load-fill.low {
        background: var(--gradient-primary);
      }
      .load-fill.medium {
        background: linear-gradient(90deg, var(--warning), #fbbf24);
      }
      .load-fill.high {
        background: linear-gradient(90deg, var(--success), #34d399);
      }
      .load-fill.complete {
        background: linear-gradient(90deg, #8b5cf6, #a78bfa);
      }

      .load-status {
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .load-status.low {
        color: var(--primary-orange);
      }
      .load-status.medium {
        color: var(--warning);
      }
      .load-status.high {
        color: var(--success);
      }
      .load-status.complete {
        color: #8b5cf6;
      }

      /* Assignment List */
      .assignments-list {
        max-height: 300px;
        overflow-y: auto;
      }

      .assignment-item {
        display: flex;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid var(--border-light);
        gap: 15px;
      }

      .assignment-item:last-child {
        border-bottom: none;
      }

      .assignment-icon {
        background: var(--gradient-primary);
        color: white;
        width: 35px;
        height: 35px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        flex-shrink: 0;
      }

      .assignment-details {
        flex: 1;
      }

      .assignment-primary {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 2px;
      }

      .assignment-secondary {
        font-size: 0.85rem;
        color: var(--text-secondary);
      }

      /* Table View */
      .results-table {
        width: 100%;
        border-collapse: collapse;
      }

      .results-table th,
      .results-table td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid var(--border-light);
      }

      .results-table th {
        background: #f8fafc;
        font-weight: bold;
        color: var(--text-primary);
        cursor: pointer;
        position: relative;
        user-select: none;
      }

      .results-table th:hover {
        background: #f1f5f9;
      }

      .sort-arrow {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        opacity: 0.5;
      }

      .sort-arrow.active {
        opacity: 1;
        color: var(--primary-blue);
      }

      /* Achievements Panel */
      .achievements-panel {
        position: fixed;
        top: 60px;
        right: -350px;
        width: 350px;
        height: calc(100vh - 60px);
        background: white;
        box-shadow: -5px 0 25px rgba(0, 0, 0, 0.1);
        transition: right 0.3s ease;
        z-index: 500;
        overflow-y: auto;
      }

      .achievements-panel.open {
        right: 0;
      }

      .achievements-header {
        background: var(--gradient-primary);
        color: white;
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .close-achievements {
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
      }

      .achievement-item {
        padding: 20px;
        border-bottom: 1px solid var(--border-light);
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .achievement-icon {
        font-size: 2rem;
      }

      .achievement-content {
        flex: 1;
      }

      .achievement-title {
        font-weight: bold;
        margin-bottom: 5px;
      }

      .achievement-desc {
        font-size: 0.85rem;
        color: var(--text-secondary);
      }

      /* Floating Action Button */
      .fab {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 60px;
        height: 60px;
        background: var(--gradient-primary);
        border: none;
        border-radius: 50%;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        z-index: 1000;
      }

      .fab:hover {
        transform: scale(1.1);
        box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3);
      }

      /* Notifications */
      .notification {
        position: fixed;
        top: 80px;
        right: 20px;
        background: var(--success);
        color: white;
        padding: 15px 20px;
        border-radius: 12px;
        box-shadow: var(--shadow-card);
        transform: translateX(400px);
        transition: transform 0.3s ease;
        z-index: 1500;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .notification.show {
        transform: translateX(0);
      }

      .notification.error {
        background: var(--error);
      }

      .notification.warning {
        background: var(--warning);
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        .header h1 {
          font-size: 2.5rem;
        }

        .search-section {
          grid-template-columns: 1fr;
        }

        .results-grid {
          grid-template-columns: 1fr;
          gap: 20px;
          padding: 20px;
        }

        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 15px;
          padding: 20px;
        }

        .filters-section {
          grid-template-columns: 1fr;
        }

        .achievements-panel {
          width: 100vw;
          right: -100vw;
        }
      }

      /* Loading States */
      .loading-skeleton {
        background: linear-gradient(
          90deg,
          #f0f0f0 25%,
          #e0e0e0 50%,
          #f0f0f0 75%
        );
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
      }

      @keyframes loading {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }

      /* Welcome Message */
      .welcome-container {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-secondary);
      }

      .welcome-icon {
        font-size: 5rem;
        margin-bottom: 25px;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .welcome-title {
        font-size: 2rem;
        margin-bottom: 15px;
        color: var(--text-primary);
      }

      .welcome-subtitle {
        font-size: 1.2rem;
        line-height: 1.6;
        max-width: 600px;
        margin: 0 auto;
      }
      /* --- START: ØªØµØ­ÙŠØ­ Ù„ÙˆÙ† Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø· Ø§Ù„Ø²Ù…Ù†ÙŠ --- */
      .timeline-proctor-name {
        font-weight: bold;
        margin-bottom: 2px;
        color: var(--text-primary); /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­) */
      }

      .dark-mode .timeline-proctor-name {
        color: var(--dark-text-primary); /* ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„ÙˆÙ† Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† */
      }
      /* --- END: ØªØµØ­ÙŠØ­ Ù„ÙˆÙ† Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø· Ø§Ù„Ø²Ù…Ù†ÙŠ --- */
      .header-content {
        display: flex;
        justify-content: space-between; /* Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¨Ù…Ø³Ø§ÙØ§Øª Ù…ØªØ³Ø§ÙˆÙŠØ© Ø¨ÙŠÙ†Ù‡Ù… */
        align-items: center; /* Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù…ÙˆØ¯ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ */
        padding: 0 25px; /* ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙŠÙ…Ø© Ù„Ø¶Ø¨Ø· Ø§Ù„Ù‡ÙˆØ§Ù…Ø´ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
      }

      .logo {
        height: 60px; /* ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø¹Ø§Ø± Ø­Ø³Ø¨ Ø±ØºØ¨ØªÙƒ */
        width: auto; /* Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© */
      }
      /* --- ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© (Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©) --- */
      .header-content {
        display: flex;
        justify-content: space-between; /* ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø·Ø±Ø§Ù */
        align-items: center; /* Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ Ø¹Ù…ÙˆØ¯ÙŠØ§Ù‹ */
        padding: 10px 25px; /* Ù‡ÙˆØ§Ù…Ø´ Ø¯Ø§Ø®Ù„ÙŠØ© */
        gap: 15px; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¥Ø°Ø§ Ø§Ù‚ØªØ±Ø¨ÙˆØ§ Ù…Ù† Ø¨Ø¹Ø¶Ù‡Ù… */
      }

      .header-content h1 {
        margin: 0; /* Ù„Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø¹Ù†ÙˆØ§Ù† */
        font-size: 2em; /* Ø­Ø¬Ù… Ø§Ù„Ø®Ø· (ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„Ù‡) */
        text-align: center; /* Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù†Øµ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ */
        white-space: nowrap; /* Ù„Ù…Ù†Ø¹ Ø§Ù†ÙƒØ³Ø§Ø± Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ */
      }

      .logo {
        height: 50px; /* Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø¹Ø§Ø± (ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„Ù‡) */
        width: auto;
        flex-shrink: 0; /* Ù„Ù…Ù†Ø¹ Ø§Ù„Ø´Ø¹Ø§Ø± Ù…Ù† Ø§Ù„Ø§Ù†ÙƒÙ…Ø§Ø´ */
      }

      /* --- ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© (Mobile Responsive) --- */
      /* ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ù‡Ø°Ù‡ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ ÙÙ‚Ø· Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø´Ø© 768px Ø£Ùˆ Ø£Ù‚Ù„ */
      @media (max-width: 768px) {
        .header-content {
          flex-direction: column; /* ØªØºÙŠÙŠØ± Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø¥Ù„Ù‰ Ø¹Ù…ÙˆØ¯ÙŠ */
          padding: 15px;
        }

        .header-content h1 {
          font-size: 1.5em; /* ØªØµØºÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        }

        .logo {
          height: 45px; /* ØªØµØºÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø´Ø¹Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
        }
      }
      .header-content {
        display: flex;
        justify-content: space-between; /* ÙŠØ¯ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ø£Ø·Ø±Ø§Ù ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ */
        align-items: center; /* ÙŠØ­Ø§Ø°ÙŠ ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù…ÙˆØ¯ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ */
        padding: 10px 25px; /* Ù‡ÙˆØ§Ù…Ø´ Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
        gap: 15px; /* Ù…Ø³Ø§ÙØ© ÙØ§ØµÙ„Ø© Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù„Ù…Ù†Ø¹ Ø§Ù„Ø§Ù„ØªØµØ§Ù‚ */
      }

      .header-content h1 {
        margin: 0;
        font-size: 2.2em; /* Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
        white-space: nowrap; /* ÙŠÙ…Ù†Ø¹ Ù†Ø²ÙˆÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¥Ù„Ù‰ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ */
        text-align: center;
        /* ÙŠØªÙ‚Ù„Øµ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù„ÙŠØ³Ù…Ø­ Ø¨Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ø´Ø¹Ø§Ø±Ø§Øª */
        flex-shrink: 1;
        min-width: 0;
      }

      .logo {
        height: 60px; /* Ø­Ø¬Ù… Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
        width: auto;
        /* ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ù† Ø§Ù„ØªÙ‚Ù„Øµ */
        flex-shrink: 0;
      }

      /* --- ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© ÙˆØ§Ù„Ù…ØªÙˆØ³Ø·Ø© (Ø£Ù‚Ù„ Ù…Ù† 768px) --- */
      @media (max-width: 768px) {
        .header-content {
          padding: 10px 15px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‡ÙˆØ§Ù…Ø´ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
          gap: 10px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„ÙØ§ØµÙ„Ø© */
        }

        .header-content h1 {
          font-size: 1.6em; /* ØªØµØºÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø®Ø· */
        }

        .logo {
          height: 45px; /* ØªØµØºÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø´Ø¹Ø§Ø±Ø§Øª */
        }
      }

      /* --- ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¶ÙŠÙ‚Ø© Ø¬Ø¯Ø§Ù‹ (Ø£Ù‚Ù„ Ù…Ù† 420px) --- */
      @media (max-width: 420px) {
        .header-content h1 {
          font-size: 1.2em; /* ØªØµØºÙŠØ± Ø§Ù„Ø®Ø· Ø¨Ø´ÙƒÙ„ Ø£ÙƒØ¨Ø± */
        }

        .logo {
          height: 35px; /* ØªØµØºÙŠØ± Ø§Ù„Ø´Ø¹Ø§Ø±Ø§Øª Ø¨Ø´ÙƒÙ„ Ø£ÙƒØ¨Ø± */
        }
      }
      /* --- START: NEW CSS FOR CONFLICTS SECTION --- */
      #conflictsContainer {
        display: none; /* Hidden by default */
        background: white;
        border-radius: 20px;
        box-shadow: var(--shadow-card);
        margin-bottom: 30px;
        border-left: 6px solid var(--error);
        overflow: hidden;
      }

      .conflicts-header {
        background: var(--error);
        color: white;
        padding: 20px 30px;
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .conflicts-header h2 {
        margin: 0;
        font-size: 1.5rem;
      }

      .conflicts-list {
        padding: 15px 30px 30px 30px;
      }

      .conflict-item {
        padding: 20px 0;
        border-bottom: 1px solid var(--border-light);
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        gap: 15px;
      }

      .conflict-item:last-child {
        border-bottom: none;
      }

      .conflict-details p {
        margin: 0;
        line-height: 1.6;
      }

      .conflict-details strong {
        color: var(--error);
      }

      .conflict-action a {
        background: var(--error);
        color: white;
        padding: 10px 18px;
        border-radius: 10px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        white-space: nowrap;
      }

      .conflict-action a:hover {
        opacity: 0.8;
        transform: translateY(-2px);
      }
      /* Enhanced Responsive Design */
      @media (max-width: 1200px) {
        .container {
          padding: 15px;
        }

        .results-grid {
          grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        }

        .stats-grid {
          grid-template-columns: repeat(3, 1fr);
        }
      }

      @media (max-width: 992px) {
        .header h1 {
          font-size: 2.8rem;
        }

        .control-header {
          flex-direction: column;
          align-items: stretch;
          gap: 15px;
        }

        .view-toggle {
          justify-content: center;
        }

        .search-section {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .quick-actions {
          flex-direction: row;
          justify-content: space-between;
        }

        .filters-section {
          grid-template-columns: repeat(2, 1fr);
        }

        .results-header {
          flex-direction: column;
          align-items: stretch;
          gap: 15px;
        }

        .results-info {
          justify-content: center;
        }

        .results-actions {
          justify-content: center;
        }

        .chart-header {
          flex-direction: column;
          align-items: stretch;
          text-align: center;
          gap: 15px;
        }

        .chart-tabs {
          justify-content: center;
        }
      }

      @media (max-width: 768px) {
        body {
          padding-top: 50px;
        }

        .ticker-banner {
          height: 45px;
        }

        .ticker-item {
          margin: 0 20px;
          padding: 6px 12px;
          font-size: 13px;
        }

        .ticker-count {
          font-size: 11px;
          padding: 3px 8px;
        }

        .container {
          padding: 10px;
        }

        .header h1 {
          font-size: 2.2rem;
        }

        .header p {
          font-size: 1.1rem;
        }

        .header-content {
          padding: 25px 20px;
        }

        .control-content {
          padding: 20px;
        }

        .view-btn {
          padding: 10px 12px;
          font-size: 0.85rem;
        }

        #searchInput {
          padding: 15px 40px 15px 15px;
          font-size: 1rem;
        }

        .search-icon {
          right: 15px;
          font-size: 1.2rem;
        }

        .filters-section {
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .filter-select,
        .filter-input {
          padding: 12px 10px;
        }

        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 15px;
          padding: 15px;
        }

        .stat-card {
          padding: 20px 15px;
        }

        .stat-icon {
          font-size: 2.5rem;
          margin-bottom: 10px;
        }

        .stat-value {
          font-size: 2rem;
        }

        .results-grid {
          grid-template-columns: 1fr;
          gap: 20px;
          padding: 15px;
        }

        .proctor-card {
          padding: 20px;
        }

        .proctor-name {
          font-size: 1.2rem;
        }

        .proctor-initials {
          width: 45px;
          height: 45px;
          font-size: 1.1rem;
        }

        .assignment-item {
          padding: 10px 0;
        }

        .assignment-icon {
          width: 30px;
          height: 30px;
          font-size: 0.8rem;
        }

        .chart-container {
          padding: 20px 15px;
        }

        .achievements-panel {
          width: 100vw;
          right: -100vw;
        }

        .achievements-header {
          padding: 15px;
        }

        .achievement-item {
          padding: 15px;
        }

        .fab {
          bottom: 20px;
          right: 20px;
          width: 55px;
          height: 55px;
          font-size: 1.3rem;
        }

        .conflict-item {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
        }

        .conflict-action a {
          padding: 8px 15px;
          font-size: 0.9rem;
        }
      }

      @media (max-width: 576px) {
        .header h1 {
          font-size: 1.8rem;
          line-height: 1.2;
        }

        .header p {
          font-size: 1rem;
          line-height: 1.4;
        }

        .control-header {
          padding: 15px 20px;
        }

        .control-title {
          font-size: 1.2rem;
        }

        .view-toggle {
          flex-direction: column;
          width: 100%;
        }

        .view-btn {
          width: 100%;
          justify-content: center;
          padding: 12px;
        }

        .quick-actions {
          flex-direction: column;
          gap: 8px;
        }

        .action-btn {
          width: 100%;
          justify-content: center;
          padding: 12px 16px;
        }

        .stats-grid {
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .stat-value {
          font-size: 1.8rem;
        }

        .results-header {
          padding: 20px;
        }

        .results-count {
          font-size: 1.1rem;
        }

        .results-actions {
          flex-direction: column;
          width: 100%;
        }

        .results-actions .action-btn {
          width: 100%;
          justify-content: center;
        }

        .chart-title {
          font-size: 1.3rem;
        }

        .chart-tabs {
          flex-direction: column;
          width: 100%;
        }

        .chart-tab {
          width: 100%;
          text-align: center;
          padding: 10px;
        }

        .results-table {
          font-size: 0.85rem;
        }

        .results-table th,
        .results-table td {
          padding: 10px 8px;
        }

        .welcome-icon {
          font-size: 4rem;
          margin-bottom: 20px;
        }

        .welcome-title {
          font-size: 1.6rem;
          margin-bottom: 12px;
        }

        .welcome-subtitle {
          font-size: 1rem;
          line-height: 1.5;
        }

        .autocomplete-dropdown {
          max-height: 200px;
        }

        .autocomplete-item {
          padding: 10px 15px;
          font-size: 0.9rem;
        }
      }

      @media (max-width: 420px) {
        .ticker-content {
          font-size: 13px;
        }

        .ticker-item {
          margin: 0 15px;
          padding: 5px 10px;
          font-size: 12px;
        }

        .header h1 {
          font-size: 1.5rem;
        }

        .header p {
          font-size: 0.95rem;
        }

        .header-content {
          padding: 20px 15px;
        }

        .control-content {
          padding: 15px;
        }

        .proctor-card {
          padding: 15px;
        }

        .load-indicator {
          padding: 12px;
        }

        .assignment-details {
          font-size: 0.9rem;
        }

        .assignment-primary {
          font-size: 0.95rem;
        }

        .assignment-secondary {
          font-size: 0.8rem;
        }

        .chart-container {
          padding: 15px 10px;
        }

        .fab {
          width: 50px;
          height: 50px;
          font-size: 1.2rem;
          bottom: 15px;
          right: 15px;
        }
      }

      /* Landscape orientation adjustments for tablets */
      @media (max-width: 1024px) and (orientation: landscape) {
        .stats-grid {
          grid-template-columns: repeat(4, 1fr);
        }

        .filters-section {
          grid-template-columns: repeat(2, 1fr);
        }

        .results-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      /* Print styles */
      @media print {
        .ticker-banner,
            .fab,
            .achievements-panel,
            .control-panel,
            .chart-container,
            .notification,
            .free-proctor-finder-panel /* HinzugefÃ¼gt, um beim Drucken auszublenden */ {
          display: none !important;
        }

        .container {
          padding: 0;
          max-width: none;
        }

        .header-content {
          background: none;
          border: none;
          color: #000;
        }

        .results-container {
          box-shadow: none;
          border: 1px solid #ccc;
        }

        .proctor-card {
          break-inside: avoid;
          box-shadow: none;
          border: 1px solid #ccc;
        }
      }
      /* --- END: NEW CSS FOR CONFLICTS SECTION --- */

      /* --- START: NEW CSS FOR FREE PROCTOR FINDER --- */
      #freeProctorFinderPanel {
        background: white;
        border-radius: 20px;
        box-shadow: var(--shadow-card);
        margin-top: 30px; /* FÃ¼gt Abstand Ã¼ber dem neuen Panel hinzu */
        margin-bottom: 30px;
        overflow: hidden;
      }

      .free-proctor-header {
        background: linear-gradient(
          135deg,
          var(--success),
          #34d399
        ); /* GrÃ¼ner Header fÃ¼r "verfÃ¼gbar" */
        color: white;
        padding: 20px 30px;
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .free-proctor-header h2 {
        margin: 0;
        font-size: 1.5rem;
      }

      .free-proctor-controls {
        padding: 30px;
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 20px;
        align-items: end;
      }

      .free-proctor-results {
        padding: 0 30px 30px 30px;
        display: none; /* StandardmÃ¤ÃŸig ausgeblendet */
      }

      .free-proctor-results h3 {
        margin-bottom: 15px;
        color: var(--text-primary);
      }

      .free-proctor-list {
        list-style: none;
        padding: 0;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 15px;
      }

      .free-proctor-item {
        background: var(--gradient-card);
        padding: 15px;
        border-radius: 12px;
        border: 2px solid var(--border-light);
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 600;
      }

      .free-proctor-item::before {
        content: "âœ…";
        font-size: 1.2rem;
      }

      /* Responsive Anpassungen fÃ¼r das neue Panel */
      @media (max-width: 768px) {
        .free-proctor-controls {
          grid-template-columns: 1fr;
          gap: 15px;
        }
        .free-proctor-header h2 {
          font-size: 1.3rem;
        }
      }
      /* --- END: NEW CSS FOR FREE PROCTOR FINDER --- */
      /* ======================================================================= */
      /* ===================== START: DARK MODE CSS STYLES ===================== */
      /* ======================================================================= */

      /* --- 1. Dark Mode Color Variables --- */
      :root {
        /* Define dark theme colors */
        --dark-bg: #1a202c;
        --dark-card: #2d3748;
        --dark-header-bg: rgba(23, 25, 35, 0.5);
        --dark-text-primary: #edf2f7;
        --dark-text-secondary: #a0aec0;
        --dark-border: #4a5568;
        --dark-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        --dark-gradient-card: linear-gradient(145deg, #2d3748, #212836);
      }

      /* --- 2. Dark Mode Toggle Button Styles --- */
      #theme-toggle {
        position: fixed;
        top: 15px;
        right: 20px;
        width: 50px;
        height: 50px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        cursor: pointer;
        z-index: 2000; /* Ensure it's on top of everything */
        display: flex;
        justify-content: center;
        align-items: center;
        transition: all 0.3s ease;
        overflow: hidden; /* Hide the icon that is not active */
      }

      #theme-toggle:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .theme-icon {
        width: 24px;
        height: 24px;
        position: absolute; /* Place icons on top of each other */
        color: white;
        transition: transform 0.4s ease, opacity 0.4s ease;
      }

      #theme-icon-sun {
        opacity: 1;
        transform: translateY(0) rotate(0deg);
      }
      #theme-icon-moon {
        opacity: 0;
        transform: translateY(30px) rotate(180deg);
      }

      /* Styles for when dark mode is active */
      .dark-mode #theme-icon-sun {
        opacity: 0;
        transform: translateY(-30px) rotate(-180deg);
      }
      .dark-mode #theme-icon-moon {
        opacity: 1;
        transform: translateY(0) rotate(0deg);
      }
      .dark-mode #theme-toggle {
        background: rgba(45, 55, 72, 0.3);
        border-color: rgba(255, 255, 255, 0.1);
      }

      /* Responsive adjustments for the toggle */
      @media (max-width: 768px) {
        #theme-toggle {
          top: 8px;
          right: 10px;
          width: 45px;
          height: 45px;
        }
      }

      /* --- 3. General Dark Mode Theme Overrides --- */
      body.dark-mode {
        background: var(--dark-bg);
        color: var(--dark-text-primary);
        transition: background-color 0.4s ease, color 0.4s ease;
      }

      /* --- START: ØªØµØ­ÙŠØ­ Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø§Ù„Ø¨Ø§Ù‡Øª ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† --- */
      .dark-mode .proctor-assignment-count,
      .dark-mode .assignment-secondary {
        /* Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ Ø£ÙØªØ­ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙˆØ¶ÙˆØ­ */
        color: #a0aec0;
      }

      .dark-mode .assignment-primary {
        /* Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ± ÙƒØ§Ù† ÙŠÙØªÙ‚Ø¯ Ø¥Ù„Ù‰ Ù„ÙˆÙ† Ø®Ø§Øµ Ø¨Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† */
        color: var(--dark-text-primary);
      }
      /* --- END: ØªØµØ­ÙŠØ­ Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø§Ù„Ø¨Ø§Ù‡Øª ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† --- */

      .dark-mode .header-content {
        background: var(--dark-header-bg);
        border-color: rgba(255, 255, 255, 0.1);
      }

      .dark-mode .header-content {
        background: var(--dark-header-bg);
        border-color: rgba(255, 255, 255, 0.1);
      }

      .dark-mode .control-panel,
      .dark-mode .stats-dashboard,
      .dark-mode .chart-container,
      .dark-mode .results-container,
      .dark-mode .achievements-panel,
      .dark-mode #conflictsContainer,
      .dark-mode #freeProctorFinderPanel {
        background: var(--dark-card);
        box-shadow: var(--dark-shadow);
        color: var(--dark-text-primary);
        border-color: var(--dark-border);
      }

      .dark-mode .welcome-title,
      .dark-mode .proctor-name,
      .dark-mode .chart-title,
      .dark-mode .results-table th,
      .dark-mode .free-proctor-results h3,
      .dark-mode h2,
      .dark-mode h3,
      .dark-mode .filter-label {
        /* <-- This is the line you are adding */
        color: var(--dark-text-primary);
      }

      .dark-mode .welcome-subtitle,
      .dark-mode .proctor-card .assignment-secondary,
      .dark-mode .stat-label,
      .dark-mode .achievement-desc,
      .dark-mode .conflict-details p:last-child,
      .dark-mode .assignment-secondary {
        color: var(--dark-text-secondary);
      }

      .dark-mode #searchInput,
      .dark-mode .filter-select,
      .dark-mode .filter-input {
        background-color: #2d3748;
        border-color: var(--dark-border);
        color: var(--dark-text-primary);
      }

      .dark-mode #searchInput::placeholder {
        color: var(--dark-text-secondary);
      }

      .dark-mode #searchInput:focus,
      .dark-mode .filter-select:focus,
      .dark-mode .filter-input:focus {
        border-color: var(--primary-orange);
        background-color: var(--dark-bg);
      }

      .dark-mode .search-icon {
        color: var(--dark-text-secondary);
      }

      .dark-mode .proctor-card,
      .dark-mode .stat-card,
      .dark-mode .free-proctor-item {
        background: var(--dark-gradient-card);
        border-color: var(--dark-border);
      }

      .dark-mode .proctor-card:hover,
      .dark-mode .stat-card:hover {
        border-color: var(--primary-orange);
        box-shadow: var(--dark-shadow);
      }

      .dark-mode .load-indicator {
        background-color: #1c2330;
        border-color: var(--dark-border);
      }

      .dark-mode .load-title,
      .dark-mode .load-percentage {
        color: var(--dark-text-primary);
      }

      .dark-mode .assignment-item,
      .dark-mode .conflict-item,
      .dark-mode .achievement-item {
        border-bottom-color: var(--dark-border);
      }

      .dark-mode .results-table th {
        background: var(--dark-bg);
      }

      .dark-mode .results-table td {
        border-bottom-color: var(--dark-border);
      }

      .dark-mode .results-table tr:hover td {
        background-color: rgba(74, 85, 104, 0.5);
      }

      .dark-mode .chart-tabs {
        background: var(--dark-bg);
      }
      /* Add this new rule for the inactive tabs */
      .dark-mode .chart-tab {
        color: var(--dark-text-secondary);
      }
      /* --- Fix for Dark Logo in Dark Mode --- */
      .dark-mode img[src*="glc.png"] {
        filter: invert(1) hue-rotate(180deg);
      }

      .dark-mode .chart-tab.active {
        background: var(--dark-card);
        color: var(--primary-blue);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }

      .dark-mode .autocomplete-dropdown {
        background: var(--dark-card);
        border-color: var(--dark-border);
      }

      .dark-mode .autocomplete-item:hover,
      .dark-mode .autocomplete-item.selected {
        background: var(--dark-bg);
      }

      .dark-mode .welcome-icon {
        /* Keep the gradient, but make sure it's visible on dark backgrounds if needed */
      }
      /* ======================================================================= */
      /* ====================== END: DARK MODE CSS STYLES ====================== */
      /* ======================================================================= */
      /* ======================================================================= */
      /* ================ START: TIMELINE VIEW ENHANCEMENTS ================== */
      /* ======================================================================= */

      .timeline-group {
        margin-bottom: 30px;
        background: var(--gradient-card);
        border-radius: 15px;
        overflow: hidden;
        border: 2px solid var(--border-light);
        transition: background 0.3s ease, border-color 0.3s ease;
      }

      .timeline-group-header {
        background: var(--gradient-primary);
        color: white;
        padding: 15px 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .timeline-group-title {
        margin: 0;
        font-size: 1.2rem;
      }

      .timeline-group-count {
        background: rgba(255, 255, 255, 0.2);
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 0.9rem;
      }

      .timeline-group-content {
        padding: 20px;
      }

      .timeline-item {
        display: flex;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid var(--border-light);
      }
      .timeline-group-content .timeline-item:last-child {
        border-bottom: none;
      }

      .timeline-item-icon {
        background: var(--gradient-primary);
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        font-size: 0.9rem;
        flex-shrink: 0;
      }

      .timeline-item-details {
        flex: 1;
      }

      .timeline-proctor-name {
        font-weight: bold;
        margin-bottom: 2px;
        color: var(--text-primary); /* Default for light mode */
      }

      .timeline-assignment-details {
        color: var(--text-secondary); /* Default for light mode */
        font-size: 0.9rem;
      }

      /* --- Dark Mode Overrides for Timeline --- */
      .dark-mode .timeline-group {
        background: var(--dark-gradient-card);
        border-color: var(--dark-border);
      }

      .dark-mode .timeline-item {
        border-bottom-color: var(--dark-border);
      }

      .dark-mode .timeline-proctor-name {
        color: var(--dark-text-primary);
      }

      .dark-mode .timeline-assignment-details {
        color: var(--dark-text-secondary);
      }

      /* ======================================================================= */
      /* ================== END: TIMELINE VIEW ENHANCEMENTS ================== */
      /* ======================================================================= */
    </style>
  </head>
  <body>
    <!-- Enhanced Ticker Banner -->
    <!-- ======================================================================= -->
    <!-- =================== START: DARK MODE TOGGLE HTML ==================== -->
    <!-- ======================================================================= -->
    <div id="theme-toggle" title="Toggle Dark/Light Mode">
      <svg
        id="theme-icon-sun"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="currentColor"
        class="theme-icon"
      >
        <path
          d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.106a.75.75 0 010 1.06l-1.591 1.592a.75.75 0 01-1.06-1.061l1.591-1.591a.75.75 0 011.06 0zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5h2.25a.75.75 0 01.75.75zM17.834 17.834a.75.75 0 01-1.06 0l-1.592-1.591a.75.75 0 111.06-1.06l1.591 1.591a.75.75 0 010 1.06zM12 21.75a.75.75 0 01-.75-.75v-2.25a.75.75 0 011.5 0v2.25a.75.75 0 01-.75.75zM5.106 17.834a.75.75 0 010-1.06l1.591-1.592a.75.75 0 011.06 1.06l-1.591 1.592a.75.75 0 01-1.06 0zM4.5 12a.75.75 0 01.75-.75h2.25a.75.75 0 010 1.5H5.25a.75.75 0 01-.75-.75zM6.106 5.106a.75.75 0 011.06 0l1.592 1.591a.75.75 0 01-1.06 1.06L6.106 6.166a.75.75 0 010-1.06z"
        />
      </svg>
      <svg
        id="theme-icon-moon"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="currentColor"
        class="theme-icon"
      >
        <path
          fill-rule="evenodd"
          d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69a.75.75 0 01.981.981A10.503 10.503 0 0118 19.5a10.5 10.5 0 01-10.5-10.5c0-1.25.18-2.457.513-3.598a.75.75 0 01.819-.162z"
          clip-rule="evenodd"
        />
      </svg>
    </div>
    <!-- ======================================================================= -->
    <!-- ==================== END: DARK MODE TOGGLE HTML ===================== -->
    <!-- ======================================================================= -->
    <div class="ticker-banner">
      <div class="ticker-content" id="tickerContent">
        <!-- Dynamic content will be populated here -->
      </div>
    </div>

    <!-- Achievements Panel -->
    <div class="achievements-panel" id="achievementsPanel">
      <div class="achievements-header">
        <h3>ğŸ† Achievements</h3>
        <button class="close-achievements" onclick="toggleAchievements()">
          Ã—
        </button>
      </div>
      <div id="achievementsList">
        <!-- Achievements will be populated here -->
      </div>
    </div>

    <div class="container">
      <!-- Enhanced Header -->
      <div class="header">
        <div class="header-content">
          <!-- Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ø£ÙŠØ³Ø± Ù‡Ù†Ø§ -->
          <img
            src="https://www.gju.edu.jo/sites/default/files/glc.png"
            alt="Left Logo"
            class="logo"
          />

          <h1>ğŸ“ Aufsichtsplan</h1>

          <!-- Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ø£ÙŠÙ…Ù† Ù‡Ù†Ø§ -->
          <img
            src="https://www.gju.edu.jo/sites/all/themes/bootstrap/images/GJU-LOGO2.png"
            alt="Right Logo"
            class="logo"
          />
        </div>
      </div>

      <!-- Control Panel -->
      <div class="control-panel">
        <div class="control-header">
          <div class="control-title">ğŸ›ï¸ Kontrollzentrum</div>
          <div class="view-toggle">
            <button
              class="view-btn active"
              onclick="switchView('cards')"
              data-view="cards"
            >
              ğŸ—‚ï¸ Karten
            </button>
            <button
              class="view-btn"
              onclick="switchView('table')"
              data-view="table"
            >
              ğŸ“Š Tabelle
            </button>
            <button
              class="view-btn"
              onclick="switchView('timeline')"
              data-view="timeline"
            >
              ğŸ“… Zeitleiste
            </button>
          </div>
        </div>

        <div class="control-content">
          <div class="search-section">
            <div class="search-box">
              <input
                type="text"
                id="searchInput"
                placeholder="Suche nach NamenskÃ¼rzel, Lab, Datum oder Sitzung... "
              />
              <span class="search-icon">ğŸ”</span>
              <div
                class="autocomplete-dropdown"
                id="autocompleteDropdown"
              ></div>
            </div>

            <div class="quick-actions">
              <button class="action-btn" id="clearBtn" onclick="clearSearch()">
                ğŸ”„ ZurÃ¼cksetzen
              </button>
              <button
                class="action-btn"
                id="exportBtn"
                onclick="exportResults()"
              >
                ğŸ“¸ Exportieren
              </button>
              <!--    <button class="action-btn" onclick="toggleAchievements()">
                            ğŸ† Awards
                        </button>-->
            </div>
          </div>

          <!-- Advanced Filters -->
          <div class="filters-section">
            <div class="filter-group">
              <label class="filter-label">ğŸ“ Lab Filter</label>
              <select class="filter-select" id="labFilter">
                <option value="">Alle Labs</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">ğŸ“… Zeitraum</label>
              <select class="filter-select" id="dateFilter">
                <option value="">Alle Termine</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">ğŸ“Š Belastungsstatus</label>
              <select class="filter-select" id="loadFilter">
                <option value="">Alle Belastungen</option>
                <option value="low">Niedrige Belastung (&lt;40%)</option>
                <option value="medium">Mittlere Belastung (40-70%)</option>
                <option value="high">Hohe Belastung (70-100%)</option>
                <option value="complete">VollstÃ¤ndig (100%+)</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">ğŸ“ Session</label>
              <select class="filter-select" id="sessionFilter">
                <option value="">Alle Sessions</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      <!-- Results Container -->
      <div class="results-container">
        <div class="results-header">
          <div class="results-info">
            <div class="results-count" id="resultsCount">
              Bereit zum Entdecken
            </div>
            <div class="results-meta" id="resultsMeta">0 totale Aufsichten</div>
          </div>
          <div class="results-actions">
            <button class="action-btn" onclick="generateReport()">
              ğŸ“‹ Bericht
            </button>
            <button class="action-btn" onclick="exportToCSV()">ğŸ“„ CSV</button>
            <button class="action-btn" onclick="printSchedule()">
              ğŸ–¨ï¸ Drucken
            </button>
          </div>
        </div>

        <div id="resultsContent">
          <div class="welcome-container">
            <div class="welcome-icon">ğŸš€</div>
            <h2 class="welcome-title">Willkommen im verbesserten System!</h2>
            <p class="welcome-subtitle">
              Beginnen Sie mit der Suche nach dem NamenskÃ¼rzel einer Lehrkraft,
              geben Sie â€...â€œ ein, um den vollstÃ¤ndigen Aufsichtsplan zu
              erhalten, oder verwenden Sie die erweiterten Filter oben.
              Entdecken Sie interaktive Diagramme, verdienen Sie Erfolge und
              entdecken Sie leistungsstarke Analysen!
            </p>
          </div>
        </div>
      </div>

      <!-- Statistics Dashboard -->
      <div class="stats-dashboard">
        <div class="stats-header">
          <h2>ğŸ“Š Live-Analyse Dashboard</h2>
        </div>
        <div class="stats-grid" id="statsGrid">
          <!-- Stats will be populated dynamically -->
        </div>
      </div>

      <!-- Chart Container -->
      <div class="chart-container">
        <div class="chart-header">
          <h3 class="chart-title">ğŸ“ˆ Visualisierung der Arbeitsbelastung</h3>
          <div class="chart-tabs">
            <button
              class="chart-tab active"
              onclick="switchChart('distribution')"
            >
              Verteilung
            </button>
            <button class="chart-tab" onclick="switchChart('timeline')">
              Zeitleiste
            </button>
            <button class="chart-tab" onclick="switchChart('comparison')">
              Vergleich
            </button>
          </div>
        </div>
        <div style="position: relative; height: 400px">
          <canvas id="workloadChart"></canvas>
        </div>
      </div>

      <!-- --- START: NEW CONFLICTS DISPLAY AREA --- -->
      <div id="conflictsContainer">
        <div class="conflicts-header">
          <h2>âš ï¸ Konflikterkennung</h2>
        </div>
        <div class="conflicts-list" id="conflictsList">
          <!-- Detected conflicts will be dynamically inserted here -->
        </div>
      </div>
      <!-- --- END: NEW CONFLICTS DISPLAY AREA --- -->

      <!-- --- START: NEW FREE PROCTOR FINDER PANEL --- -->
      <div id="freeProctorFinderPanel">
        <div class="free-proctor-header">
          <h2>ğŸ—“ï¸ Finde verfÃ¼gbare Aufsichtspersonen</h2>
        </div>
        <div class="free-proctor-controls">
          <div class="filter-group">
            <label class="filter-label"
              >WÃ¤hle einen Zeitpunkt, um zu sehen, wer verfÃ¼gbar ist</label
            >
            <select class="filter-select" id="freeTimeSelector">
              <option value="">Bitte Zeitpunkt wÃ¤hlen...</option>
            </select>
          </div>
          <button class="action-btn" id="findFreeBtn">
            ğŸ” VerfÃ¼gbare finden
          </button>
        </div>
        <div class="free-proctor-results" id="freeProctorsResult">
          <!-- Results will be populated here -->
        </div>
      </div>
      <!-- --- END: NEW FREE PROCTOR FINDER PANEL --- -->
    </div>

    <!-- Floating Action Button -->
    <button class="fab" onclick="showQuickHelp()" title="Quick Help">â“</button>

    <!-- Notification Container -->
    <!-- <div class="notification" id="notification">
        <span id="notificationText"></span>
    </div>-->

    <!-- Include Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
      // Enhanced Configuration
      const CONFIG = {
        REQUIRED_LOAD: 6,
        ANIMATION_DURATION: 300,
        CHART_COLORS: {
          orange: "#FF8C00",
          blue: "#1E90FF",
          green: "#10b981",
          yellow: "#f59e0b",
          purple: "#8b5cf6",
          red: "#ef4444",
        },
      };

      // Enhanced Dataset
      const proctorData = [
        {
          proctor: "AAS",
          lab: "D016",
          date: "23. Aug. 15:00-17:00",
          session: "D4",
        },
        {
          proctor: "EMO",
          lab: "D016",
          date: "23. Aug. 15:00-17:00",
          session: "D4",
        },
        {
          proctor: "BUT",
          lab: "D016",
          date: "23. Aug. 15:00-17:00",
          session: "D4",
        },
        {
          proctor: "DAN",
          lab: "D016",
          date: "23. Aug. 15:00-17:00",
          session: "D4",
        },
        {
          proctor: "YT",
          lab: "D016",
          date: "23. Aug. 15:00-17:00",
          session: "D4",
        },
        {
          proctor: "MAW",
          lab: "D016",
          date: "23. Aug. 15:00-17:00",
          session: "D4",
        },
        {
          proctor: "OBA",
          lab: "D016",
          date: "23. Aug. 15:00-17:00",
          session: "D4",
        },
        {
          proctor: "ODE",
          lab: "D016",
          date: "23. Aug. 15:00-17:00",
          session: "D4",
        },
        {
          proctor: "RAM",
          lab: "D016",
          date: "23. Aug. 15:00-17:00",
          session: "D4",
        },
        {
          proctor: "SHA",
          lab: "D016",
          date: "23. Aug. 15:00-17:00",
          session: "D4",
        },
        {
          proctor: "AAS",
          lab: "L208",
          date: "24. Aug. 14:00-16:00",
          session: "D3 Nu",
        },
        {
          proctor: "MAW",
          lab: "L208",
          date: "24. Aug. 14:00-16:00",
          session: "D3 Nu",
        },
        {
          proctor: "MQ",
          lab: "L208",
          date: "24. Aug. 14:00-16:00",
          session: "D3 Nu",
        },
        {
          proctor: "EMO",
          lab: "L208",
          date: "24. Aug. 14:00-16:00",
          session: "D3 Nu",
        },
        {
          proctor: "ODE",
          lab: "C126",
          date: "25. Aug. 14:00-16:00",
          session: "D1",
        },
        {
          proctor: "MQ",
          lab: "C126",
          date: "25. Aug. 14:00-16:00",
          session: "D1",
        },
        {
          proctor: "SOB",
          lab: "C126",
          date: "25. Aug. 14:00-16:00",
          session: "D1",
        },
        {
          proctor: "MAW",
          lab: "C106",
          date: "26. Aug. 9:00-11:00",
          session: "D3",
        },
        {
          proctor: "ODE",
          lab: "C106",
          date: "26. Aug. 9:00-11:00",
          session: "D3",
        },
        {
          proctor: "YT",
          lab: "C106",
          date: "26. Aug. 9:00-11:00",
          session: "D3",
        },
        {
          proctor: "RAL",
          lab: "C126",
          date: "26. Aug. 9:00-11:00",
          session: "D3",
        },
        {
          proctor: "SHA",
          lab: "C126",
          date: "26. Aug. 9:00-11:00",
          session: "D3",
        },
        {
          proctor: "SOB",
          lab: "C126",
          date: "26. Aug. 9:00-11:00",
          session: "D3",
        },
        {
          proctor: "RAM",
          lab: "C131",
          date: "26. Aug. 9:00-11:00",
          session: "D3",
        },
        {
          proctor: "OBA",
          lab: "C131",
          date: "26. Aug. 9:00-11:00",
          session: "D3",
        },
        {
          proctor: "MQ",
          lab: "C402",
          date: "26. Aug. 9:00-11:00",
          session: "D3",
        },
        {
          proctor: "AAS",
          lab: "C402",
          date: "26. Aug. 9:00-11:00",
          session: "D3",
        },
        {
          proctor: "TRE",
          lab: "C402",
          date: "26. Aug. 9:00-11:00",
          session: "D3",
        },
        {
          proctor: "DAN",
          lab: "C403",
          date: "26. Aug. 9:00-11:00",
          session: "D3",
        },
        {
          proctor: "EMO",
          lab: "C403",
          date: "26. Aug. 9:00-11:00",
          session: "D3",
        },
        {
          proctor: "AMZ",
          lab: "C403",
          date: "26. Aug. 9:00-11:00",
          session: "D3",
        },
        {
          proctor: "MQ",
          lab: "B105",
          date: "27. Aug. 9:00-11:00",
          session: "D4 NU",
        },
        {
          proctor: "BUT",
          lab: "B105",
          date: "27. Aug. 9:00-11:00",
          session: "D4 NU",
        },
        {
          proctor: "RAM",
          lab: "H201",
          date: "27. Aug. 9:00-11:00",
          session: "D2",
        },
         {
          proctor: "AAS",
          lab: "H201",
          date: "27. Aug. 9:00-11:00",
          session: "D2",
        },
         {
          proctor: "DAN",
          lab: "H202",
          date: "27. Aug. 9:00-11:00",
          session: "D2",
        },
         {
          proctor: "SAH",
          lab: "H202",
          date: "27. Aug. 9:00-11:00",
          session: "D2",
        },
         {
          proctor: "RAL",
          lab: "H203",
          date: "27. Aug. 9:00-11:00",
          session: "D2",
        },
          {
          proctor: "GH",
          lab: "H203",
          date: "27. Aug. 9:00-11:00",
          session: "D2",
        },
        {
          proctor: "MQ",
          lab: "C126",
          date: "28. Aug. 11:30-13:30",
          session: "D5 NU",
        },
        {
          proctor: "EMO",
          lab: "C126",
          date: "28. Aug. 11:30-13:30",
          session: "D5 NU",
        },

      ];

      // State Management
      let currentView = "cards";
      let currentChart = null;
      let filteredResults = [];
      let searchHistory = [];
      let achievements = [];
      let userPreferences = {};

      // DOM Elements
      const searchInput = document.getElementById("searchInput");
      const autocompleteDropdown = document.getElementById(
        "autocompleteDropdown"
      );
      const resultsContent = document.getElementById("resultsContent");
      const resultsCount = document.getElementById("resultsCount");
      const resultsMeta = document.getElementById("resultsMeta");
      const statsGrid = document.getElementById("statsGrid");
      // --- START: NEW DOM ELEMENTS FOR CONFLICTS ---
      const conflictsContainer = document.getElementById("conflictsContainer");
      const conflictsList = document.getElementById("conflictsList");
      // --- END: NEW DOM ELEMENTS FOR CONFLICTS ---

      // --- START: NEW DOM ELEMENTS FOR FREE PROCTOR FINDER ---
      const freeTimeSelector = document.getElementById("freeTimeSelector");
      const findFreeBtn = document.getElementById("findFreeBtn");
      const freeProctorsResult = document.getElementById("freeProctorsResult");
      // --- END: NEW DOM ELEMENTS FOR FREE PROCTOR FINDER ---

      // Initialize Application
      document.addEventListener("DOMContentLoaded", () => {
        initializeFilters();
        initializeStats();
        initializeChart();
        initializeTicker();
        initializeFreeProctorFinder(); // HinzugefÃ¼gte Funktion
        loadUserPreferences();
        setupEventListeners();
        checkAchievements();

        // --- START: MODIFIED CONFLICT CHECKING LOGIC ---
        const detectedConflicts = findConflicts(proctorData);
        if (detectedConflicts.length > 0) {
          console.warn("SCHEDULING CONFLICTS DETECTED:", detectedConflicts);
          displayConflicts(detectedConflicts);
        }
        // --- END: MODIFIED CONFLICT CHECKING LOGIC ---
      });

      // Filter Initialization
      function initializeFilters() {
        const labs = [
          ...new Set(proctorData.map((item) => item.lab).filter(Boolean)),
        ].sort();
        const dates = [...new Set(proctorData.map((item) => item.date))].sort();
        const sessions = [
          ...new Set(proctorData.map((item) => item.session)),
        ].sort();

        populateFilter("labFilter", labs);
        populateFilter("dateFilter", dates);
        populateFilter("sessionFilter", sessions);
      }

      function populateFilter(filterId, options) {
        const select = document.getElementById(filterId);
        options.forEach((option) => {
          const optionElement = document.createElement("option");
          optionElement.value = option;
          optionElement.textContent = option;
          select.appendChild(optionElement);
        });
      }

      // Statistics Dashboard
      function initializeStats() {
        updateStatsDashboard(proctorData);
      }

      function updateStatsDashboard(data) {
        const stats = calculateStatistics(data);
        const statsHTML = `
                <div class="stat-card">
                    <div class="stat-icon">ğŸ‘¥</div>
                    <div class="stat-value">${stats.totalProctors}</div>
                    <div class="stat-label">Aktive Aufsichtspersonen</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“‹</div>
                    <div class="stat-value">${stats.totalAssignments}</div>
                    <div class="stat-label">Totale Aufsichten</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ¢</div>
                    <div class="stat-value">${stats.activeLabs}</div>
                    <div class="stat-label">Active Labs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“Š</div>
                    <div class="stat-value">${stats.averageLoad}%</div>
                    <div class="stat-label">Durchschnittliche Belastung</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">âš ï¸</div>
                    <div class="stat-value">${stats.underloaded}</div>
                    <div class="stat-label">Unterbelastet</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ¯</div>
                    <div class="stat-value">${stats.optimal}</div>
                    <div class="stat-label">Optimale Belastung</div>
                </div>
            `;
        statsGrid.innerHTML = statsHTML;
      }

      function calculateStatistics(data) {
        const proctorCounts = {};
        data.forEach((item) => {
          if (item.proctor && item.proctor.trim() !== "") {
            proctorCounts[item.proctor] =
              (proctorCounts[item.proctor] || 0) + 1;
          }
        });

        const loads = Object.values(proctorCounts);
        const totalProctors = Object.keys(proctorCounts).length;
        const totalAssignments = data.filter(
          (item) => item.proctor && item.proctor.trim() !== ""
        ).length;
        const activeLabs = new Set(data.map((item) => item.lab).filter(Boolean))
          .size;
        const averageLoad =
          loads.length > 0
            ? Math.round(
                (loads.reduce((a, b) => a + b, 0) /
                  loads.length /
                  CONFIG.REQUIRED_LOAD) *
                  100
              )
            : 0;
        const underloaded = loads.filter(
          (load) => load / CONFIG.REQUIRED_LOAD < 0.7
        ).length;
        const optimal = loads.filter((load) => {
          const percentage = load / CONFIG.REQUIRED_LOAD;
          return percentage >= 0.7 && percentage <= 1.0;
        }).length;

        return {
          totalProctors,
          totalAssignments,
          activeLabs,
          averageLoad,
          underloaded,
          optimal,
        };
      }

      // Chart Initialization
      function initializeChart() {
        const ctx = document.getElementById("workloadChart").getContext("2d");
        currentChart = new Chart(ctx, {
          type: "doughnut",
          data: getChartData("distribution"),
          options: getChartOptions("distribution"),
        });
      }

      function getChartData(type) {
        const proctorCounts = {};
        proctorData.forEach((item) => {
          if (item.proctor && item.proctor.trim() !== "") {
            proctorCounts[item.proctor] =
              (proctorCounts[item.proctor] || 0) + 1;
          }
        });

        switch (type) {
          case "distribution":
            const categories = { low: 0, medium: 0, high: 0, complete: 0 };
            Object.values(proctorCounts).forEach((count) => {
              const percentage = (count / CONFIG.REQUIRED_LOAD) * 100;
              if (percentage >= 100) categories.complete++;
              else if (percentage >= 70) categories.high++;
              else if (percentage >= 40) categories.medium++;
              else categories.low++;
            });

            return {
              labels: [
                "Niedrige Belastung",
                "Mittlere Belastung",
                "Hohe Belastung",
                "VollstÃ¤ndig",
              ],
              datasets: [
                {
                  data: [
                    categories.low,
                    categories.medium,
                    categories.high,
                    categories.complete,
                  ],
                  backgroundColor: [
                    CONFIG.CHART_COLORS.orange,
                    CONFIG.CHART_COLORS.yellow,
                    CONFIG.CHART_COLORS.green,
                    CONFIG.CHART_COLORS.purple,
                  ],
                  borderWidth: 3,
                  borderColor: "#fff",
                },
              ],
            };

          case "timeline":
            const dateData = {};
            proctorData.forEach((item) => {
              if (item.proctor && item.proctor.trim() !== "") {
                const date = item.date.split(" ")[0];
                dateData[date] = (dateData[date] || 0) + 1;
              }
            });

            return {
              labels: Object.keys(dateData).sort(),
              datasets: [
                {
                  label: "Aufsichten pro Day",
                  data: Object.values(dateData),
                  backgroundColor: CONFIG.CHART_COLORS.blue,
                  borderColor: CONFIG.CHART_COLORS.orange,
                  borderWidth: 2,
                  fill: true,
                },
              ],
            };

          case "comparison":
            const topProctors = Object.entries(proctorCounts)
              .sort(([, a], [, b]) => b - a)
              .slice(0, 8);

            return {
              labels: topProctors.map(([name]) => name.split(" ")[0]),
              datasets: [
                {
                  label: "Aufsichten",
                  data: topProctors.map(([, count]) => count),
                  backgroundColor: CONFIG.CHART_COLORS.orange,
                  borderColor: CONFIG.CHART_COLORS.blue,
                  borderWidth: 2,
                },
              ],
            };

          default:
            return {};
        }
      }

      function getChartOptions(type) {
        const baseOptions = {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: "bottom",
              labels: {
                padding: 20,
                usePointStyle: true,
              },
            },
          },
        };

        switch (type) {
          case "distribution":
            return {
              ...baseOptions,
              cutout: "60%",
              plugins: {
                ...baseOptions.plugins,
                tooltip: {
                  callbacks: {
                    label: function (context) {
                      const total = context.dataset.data.reduce(
                        (a, b) => a + b,
                        0
                      );
                      const percentage = ((context.raw / total) * 100).toFixed(
                        1
                      );
                      return `${context.label}: ${context.raw} proctors (${percentage}%)`;
                    },
                  },
                },
              },
            };

          case "timeline":
            return {
              ...baseOptions,
              type: "line",
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    stepSize: 1,
                  },
                },
              },
            };

          case "comparison":
            return {
              ...baseOptions,
              type: "bar",
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    stepSize: 1,
                  },
                },
              },
            };

          default:
            return baseOptions;
        }
      }

      // Ticker Functionality
      function initializeTicker() {
        updateTicker();
        setInterval(updateTicker, 15000); // Update every 15 seconds
      }

      function updateTicker() {
        const proctorCounts = {};
        proctorData.forEach((item) => {
          if (item.proctor && item.proctor.trim() !== "") {
            const proctorName = item.proctor.trim();
            proctorCounts[proctorName] = (proctorCounts[proctorName] || 0) + 1;
          }
        });

        const sortedProctors = Object.entries(proctorCounts).sort(
          ([, a], [, b]) => b - a
        );
        const tickerContentEl = document.getElementById("tickerContent");

        if (sortedProctors.length === 0) {
          tickerContentEl.innerHTML = "";
          return;
        }

        const topRankedProctors = [];
        let lastCount = -1;
        let rank = -1;
        const rankEmojis = ["ğŸ¥‡", "ğŸ¥ˆ", "ğŸ¥‰"];

        for (const [proctor, count] of sortedProctors) {
          if (count < lastCount) {
            rank++;
          }
          if (rank === -1) {
            rank = 0;
          }
          if (rank >= rankEmojis.length) {
            break;
          }
          topRankedProctors.push({
            proctor,
            count,
            rankEmoji: rankEmojis[rank],
          });
          lastCount = count;
        }

        const tickerItemsHTML = topRankedProctors
          .map(
            (item) => `
        <span class="ticker-item">
            <span class="ticker-rank">${item.rankEmoji}</span>
            <span class="ticker-names">${item.proctor}</span>
            <span class="ticker-count">${item.count} Aufsicht${
              item.count !== 1 ? "en" : ""
            }</span>
        </span>
    `
          )
          .join("");

        // Ù†Ù‚ÙˆÙ… Ø¨ØªÙƒØ±Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø³Ù„Ø³
        tickerContentEl.innerHTML = `
        <span>${tickerItemsHTML}</span>
        <span>${tickerItemsHTML}</span>
    `;

        // --- Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ù„Ù…Ù‡Ù…: Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ ---
        const contentSpan = tickerContentEl.querySelector("span");
        if (contentSpan) {
          // Ø³Ø±Ø¹Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¨Ø§Ù„Ø¨ÙƒØ³Ù„ ÙÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠØ©. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù„Ø²ÙŠØ§Ø¯Ø© Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø³Ø±Ø¹Ø©.
          const PIXELS_PER_SECOND = 80;

          // Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù„Ù…Ø­ØªÙˆÙ‰
          const contentWidth = contentSpan.scrollWidth;

          // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø³Ø±Ø¹Ø© Ø«Ø§Ø¨ØªØ©
          const duration = contentWidth / PIXELS_PER_SECOND;

          // ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¯Ø© Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ØµØ±
          tickerContentEl.style.animationDuration = `${duration}s`;
        }
      }

      // Enhanced Search Functionality
      function setupEventListeners() {
        searchInput.addEventListener("input", handleSearch);
        searchInput.addEventListener("keydown", handleSearchKeydown);

        // Filter listeners
        ["labFilter", "dateFilter", "loadFilter", "sessionFilter"].forEach(
          (filterId) => {
            document
              .getElementById(filterId)
              .addEventListener("change", applyFilters);
          }
        );

        // Close autocomplete when clicking outside
        document.addEventListener("click", (e) => {
          if (!e.target.closest(".search-box")) {
            hideAutocomplete();
          }
        });

        // --- START: NEW EVENT LISTENER FOR FREE PROCTOR FINDER ---
        findFreeBtn.addEventListener("click", findAndDisplayFreeProctors);
        // --- END: NEW EVENT LISTENER ---
      }

      function handleSearch(e) {
        const query = e.target.value.trim();
        updateSearchHistory(query);

        if (query.length > 0) {
          showAutocomplete(query);
          performSearch(query);
        } else {
          hideAutocomplete();
          showWelcomeMessage();
        }
      }

      function handleSearchKeydown(e) {
        if (e.key === "Enter") {
          const query = e.target.value.trim();
          if (query) {
            performSearch(query);
            hideAutocomplete();
          }
        }
      }

      function showAutocomplete(query) {
        const suggestions = generateSuggestions(query);
        if (suggestions.length === 0) {
          hideAutocomplete();
          return;
        }

        const suggestionHTML = suggestions
          .map(
            (suggestion) => `
                <div class="autocomplete-item" onclick="selectSuggestion('${suggestion.value}')">
                    <span>${suggestion.icon}</span>
                    <span>${suggestion.label}</span>
                </div>
            `
          )
          .join("");

        autocompleteDropdown.innerHTML = suggestionHTML;
        autocompleteDropdown.style.display = "block";
      }

      function generateSuggestions(query) {
        const suggestions = [];
        const lowerQuery = query.toLowerCase();

        // Proctor suggestions
        const proctors = [
          ...new Set(proctorData.map((item) => item.proctor).filter(Boolean)),
        ];
        proctors.forEach((proctor) => {
          if (proctor.toLowerCase().includes(lowerQuery)) {
            suggestions.push({
              icon: "ğŸ‘¤",
              label: proctor,
              value: proctor,
              type: "proctor",
            });
          }
        });

        // Lab suggestions
        const labs = [
          ...new Set(proctorData.map((item) => item.lab).filter(Boolean)),
        ];
        labs.forEach((lab) => {
          if (lab.toLowerCase().includes(lowerQuery)) {
            suggestions.push({
              icon: "ğŸ¢",
              label: `Lab ${lab}`,
              value: lab,
              type: "lab",
            });
          }
        });

        // Special commands
        if ("gju".includes(lowerQuery)) {
          suggestions.push({
            icon: "ğŸ“",
            label: "Show full schedule (GJU)",
            value: "GJU",
            type: "command",
          });
        }

        return suggestions.slice(0, 6);
      }

      function selectSuggestion(value) {
        searchInput.value = value;
        performSearch(value);
        hideAutocomplete();
      }

      function hideAutocomplete() {
        autocompleteDropdown.style.display = "none";
      }

      // Enhanced Search Logic
      function performSearch(query) {
        showLoading();

        setTimeout(() => {
          let results = [];

          if (query.toLowerCase() === "gju") {
            results = proctorData.filter(
              (item) => item.proctor && item.proctor.trim() !== ""
            );
          } else {
            results = proctorData.filter((item) => {
              if (!item.proctor || item.proctor.trim() === "") return false;

              const searchFields = [
                item.proctor,
                item.lab,
                item.date,
                item.session,
              ]
                .join(" ")
                .toLowerCase();

              return searchFields.includes(query.toLowerCase());
            });
          }

          filteredResults = results;
          applyFilters();
          updateStatsDashboard(filteredResults);
          checkAchievements();
        }, CONFIG.ANIMATION_DURATION);
      }

      function applyFilters() {
        const labFilter = document.getElementById("labFilter").value;
        const dateFilter = document.getElementById("dateFilter").value;
        const loadFilter = document.getElementById("loadFilter").value;
        const sessionFilter = document.getElementById("sessionFilter").value;

        let filtered = [...filteredResults];

        if (labFilter) {
          filtered = filtered.filter((item) => item.lab === labFilter);
        }

        if (dateFilter) {
          filtered = filtered.filter((item) => item.date === dateFilter);
        }

        if (sessionFilter) {
          filtered = filtered.filter((item) => item.session === sessionFilter);
        }

        if (loadFilter) {
          const proctors = [...new Set(filtered.map((item) => item.proctor))];
          const filteredProctors = proctors.filter((proctor) => {
            const load = calculateProctorLoad(proctor);
            return load.status === loadFilter;
          });
          filtered = filtered.filter((item) =>
            filteredProctors.includes(item.proctor)
          );
        }

        displayResults(filtered);
      }

      // Display Results
      function displayResults(results) {
        updateResultsHeader(results);

        switch (currentView) {
          case "cards":
            displayCardsView(results);
            break;
          case "table":
            displayTableView(results);
            break;
          case "timeline":
            displayTimelineView(results);
            break;
        }
      }

      function updateResultsHeader(results) {
        resultsCount.textContent = `${results.length} Aufsichten gefunden${
          results.length !== 1 ? "" : ""
        }`;

        const uniqueProctors = new Set(results.map((item) => item.proctor))
          .size;
        resultsMeta.textContent = `${uniqueProctors} Aufsichtsperson${
          uniqueProctors !== 1 ? "en" : ""
        } â€¢ ${results.length} totale Aufsichten`;
      }

      function displayCardsView(results) {
        if (results.length === 0) {
          showNoResults();
          return;
        }

        // Group by proctor
        const groupedResults = results.reduce((groups, item) => {
          if (!groups[item.proctor]) {
            groups[item.proctor] = [];
          }
          groups[item.proctor].push(item);
          return groups;
        }, {});

        const cardsHTML = Object.entries(groupedResults)
          .map(([proctor, assignments]) => {
            const load = calculateProctorLoad(proctor);
            const initials = proctor
              .split(" ")
              .map((word) => word[0])
              .join("")
              .toUpperCase();

            return `
                    <div class="proctor-card">
                        <div class="proctor-header">
                            <div>
                                <div class="proctor-name">${highlightMatch(
                                  proctor,
                                  searchInput.value
                                )}</div>
                              <div class="proctor-assignment-count">${
                                assignments.length
                              } Aufsicht${
              assignments.length !== 1 ? "en" : ""
            }</div>
                            </div>
                            <div class="proctor-initials">${initials}</div>
                        </div>
                        
                        <div class="load-indicator">
                            <div class="load-header">
                                <span class="load-title">Fortschritt bei der Arbeitsbelastung</span>
                                <span class="load-percentage ${
                                  load.status
                                }">${Math.round(load.percentage)}%</span>
                            </div>
                            <div class="load-bar">
                                <div class="load-fill ${
                                  load.status
                                }" style="width: ${load.percentage}%"></div>
                            </div>
                            <div class="load-status ${load.status}">${
              load.statusText
            } â€¢ ${load.assignments}/${load.required}</div>
                        </div>
                        
                        <div class="assignments-list">
                            ${assignments
                              .map(
                                (assignment) => `
                                <div class="assignment-item">
                                    <div class="assignment-icon">ğŸ¢</div>
                                    <div class="assignment-details">
                                        <div class="assignment-primary">${assignment.lab} â€¢ ${assignment.session}</div>
                                        <div class="assignment-secondary">ğŸ“… ${assignment.date}</div>
                                    </div>
                                </div>
                            `
                              )
                              .join("")}
                        </div>
                    </div>
                `;
          })
          .join("");

        resultsContent.innerHTML = `<div class="results-grid">${cardsHTML}</div>`;
      }

      function displayTableView(results) {
        if (results.length === 0) {
          showNoResults();
          return;
        }

        const tableHTML = `
                <div style="overflow-x: auto; padding: 30px;">
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th onclick="sortTable('proctor')">
                                    Proctor <span class="sort-arrow">â†•ï¸</span>
                                </th>
                                <th onclick="sortTable('lab')">
                                    Lab <span class="sort-arrow">â†•ï¸</span>
                                </th>
                                <th onclick="sortTable('date')">
                                    Date <span class="sort-arrow">â†•ï¸</span>
                                </th>
                                <th onclick="sortTable('session')">
                                    Session <span class="sort-arrow">â†•ï¸</span>
                                </th>
                                <th onclick="sortTable('load')">
                                    Load <span class="sort-arrow">â†•ï¸</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            ${results
                              .map((item) => {
                                const load = calculateProctorLoad(item.proctor);
                                return `
                                    <tr>
                                        <td><strong>${highlightMatch(
                                          item.proctor,
                                          searchInput.value
                                        )}</strong></td>
                                        <td>ğŸ¢ ${item.lab}</td>
                                        <td>ğŸ“… ${item.date}</td>
                                        <td>ğŸ“ ${item.session}</td>
                                        <td>
                                            <span class="load-status ${
                                              load.status
                                            }">
                                                ${Math.round(
                                                  load.percentage
                                                )}% (${load.assignments}/${
                                  load.required
                                })
                                            </span>
                                        </td>
                                    </tr>
                                `;
                              })
                              .join("")}
                        </tbody>
                    </table>
                </div>
            `;

        resultsContent.innerHTML = tableHTML;
      }

      function displayTimelineView(results) {
        if (results.length === 0) {
          showNoResults();
          return;
        }

        // Group by date
        const dateGroups = results.reduce((groups, item) => {
          const date = item.date.split(" ")[0];
          if (!groups[date]) {
            groups[date] = [];
          }
          groups[date].push(item);
          return groups;
        }, {});

        const timelineHTML = Object.entries(dateGroups)
          .sort(([a], [b]) => new Date(a) - new Date(b)) // Sort dates correctly
          .map(
            ([date, items]) => `
                    <div class="timeline-group">
                        <div class="timeline-group-header">
                            <h3 class="timeline-group-title">ğŸ“… ${date}</h3>
                            <span class="timeline-group-count">${
                              items.length
                            } Aufsichten</span>
                        </div>
                        <div class="timeline-group-content">
                            ${items
                              .map(
                                (item) => `
                                <div class="timeline-item">
                                    <div class="timeline-item-icon">
                                        ${item.date.split(" ")[1]}
                                    </div>
                                    <div class="timeline-item-details">
                                        <div class="timeline-proctor-name">${
                                          item.proctor
                                        }</div>
                                        <div class="timeline-assignment-details">ğŸ¢ ${
                                          item.lab
                                        } â€¢ ğŸ“ ${item.session}</div>
                                    </div>
                                </div>
                            `
                              )
                              .join("")}
                        </div>
                    </div>
                `
          )
          .join("");

        resultsContent.innerHTML = `<div style="padding: 30px;">${timelineHTML}</div>`;
      }

      // Utility Functions
      function calculateProctorLoad(proctorName) {
        const assignments = proctorData.filter(
          (item) => item.proctor === proctorName
        ).length;
        const percentage = Math.min(
          (assignments / CONFIG.REQUIRED_LOAD) * 100,
          100
        );

        let status, statusText;
        if (percentage >= 100) {
          status = "complete";
          statusText = "VollstÃ¤ndig";
        } else if (percentage >= 70) {
          status = "high";
          statusText = "Auf Kurs";
        } else if (percentage >= 40) {
          status = "medium";
          statusText = "Partiell";
        } else {
          status = "low";
          statusText = "Gering";
        }

        return {
          assignments,
          percentage,
          status,
          statusText,
          required: CONFIG.REQUIRED_LOAD,
        };
      }
      function findConflicts(data) {
        const conflicts = [];
        const assignmentsByTime = {};

        // First, group all assignments by date and time
        data.forEach((assignment, index) => {
          if (!assignment.date || !assignment.proctor) return;

          const timeSlot = assignment.date.trim(); // "01. Jan 08:30"

          if (!assignmentsByTime[timeSlot]) {
            assignmentsByTime[timeSlot] = [];
          }
          assignmentsByTime[timeSlot].push({
            ...assignment,
            originalIndex: index,
          });
        });

        // Now, check each time slot for duplicate proctors
        for (const timeSlot in assignmentsByTime) {
          const proctorsInSlot = {};
          const slotAssignments = assignmentsByTime[timeSlot];

          slotAssignments.forEach((assignment) => {
            const proctorName = assignment.proctor.trim();
            if (!proctorsInSlot[proctorName]) {
              proctorsInSlot[proctorName] = [];
            }
            proctorsInSlot[proctorName].push(assignment);
          });

          // If a proctor appears more than once, it's a conflict
          for (const proctorName in proctorsInSlot) {
            if (proctorsInSlot[proctorName].length > 1) {
              conflicts.push({
                proctor: proctorName,
                time: timeSlot,
                assignments: proctorsInSlot[proctorName], // List of conflicting assignments
              });
            }
          }
        }

        return conflicts;
      }
      // --- START: NEW FUNCTION TO DISPLAY CONFLICTS ---
      function displayConflicts(conflicts) {
        if (!conflicts || conflicts.length === 0) {
          conflictsContainer.style.display = "none";
          return;
        }

        const conflictsHTML = conflicts
          .map((conflict) => {
            const labs = conflict.assignments.map((a) => a.lab).join(" und ");
            return `
                    <div class="conflict-item">
                        <div class="conflict-details">
                            <p>
                                <strong>${conflict.proctor}</strong> hat einen Zeitkonflikt.
                            </p>
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">
                                 Doppelt gebucht um ${conflict.time} in den Labs: ${labs}
                            </p>
                        </div>
                        <div class="conflict-action">
                            <a href="#" onclick="jumpToProctor('${conflict.proctor}')">Zum PrÃ¼fer springen</a>
                        </div>
                    </div>
                `;
          })
          .join("");

        conflictsList.innerHTML = conflictsHTML;
        conflictsContainer.style.display = "block";
      }

      // --- START: NEW HELPER FUNCTION TO JUMP TO A PROCTOR ---
      function jumpToProctor(proctorName) {
        event.preventDefault(); // Prevent the link from navigating
        searchInput.value = proctorName;
        performSearch(proctorName);

        // Scroll to the top of the results for better UX
        const controlPanel = document.querySelector(".control-panel");
        if (controlPanel) {
          controlPanel.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }
      // --- END: NEW HELPER FUNCTIONS ---

      function highlightMatch(text, query) {
        if (!query || !text) return text;
        const regex = new RegExp(`(${query})`, "gi");
        return text.replace(
          regex,
          '<mark style="background: #fff3cd; padding: 2px 4px; border-radius: 3px;">$1</mark>'
        );
      }

      function showWelcomeMessage() {
        resultsCount.textContent = "Bereit zum Entdecken";
        resultsMeta.textContent = `${proctorData.length} VerfÃ¼gbare Aufsichten insgesamt`;
        resultsContent.innerHTML = `
                <div class="welcome-container">
                    <div class="welcome-icon">ğŸš€</div>
                    <h2 class="welcome-title">Willkommen im Verbesserten System!</h2>
                    <p class="welcome-subtitle">Beginnen Sie mit der Suche nach dem NamenkÃ¼rzel einer Aufsichtsperson, geben Sie â€...â€œ ein, um den vollstÃ¤ndigen Aufsichtsplan zu erhalten, oder verwenden Sie die erweiterten Filter oben. Entdecken Sie interaktive Diagramme, verdienen Sie Erfolge und entdecken Sie leistungsstarke Analysen!</p>
                </div>
            `;
      }

      function showLoading() {
        resultsContent.innerHTML = `
                <div style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">
                    <div class="loading-skeleton" style="width: 60px; height: 60px; border-radius: 50%; margin: 0 auto 20px;"></div>
                    <h3>Analysieren von Daten...</h3>
                    <p>Bearbeitung Ihrer Anfrage mit fortschrittlichen Algorithmen</p>
                </div>
            `;
      }

      function showNoResults() {
        resultsContent.innerHTML = `
                <div style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">
                    <div style="font-size: 5rem; margin-bottom: 20px;">ğŸ¤·â€â™‚ï¸</div>
                    <h3>Keine Ergebnisse gefunden</h3>
                    <p>Versuchen Sie, Ihre Suchbegriffe oder Filter anzupassen</p>
                </div>
            `;
      }

      // View Management
      function switchView(viewType) {
        currentView = viewType;

        // Update active button
        document.querySelectorAll(".view-btn").forEach((btn) => {
          btn.classList.remove("active");
          if (btn.dataset.view === viewType) {
            btn.classList.add("active");
          }
        });

        // Re-display results in new view
        displayResults(filteredResults);

        // Save preference
        userPreferences.preferredView = viewType;
        saveUserPreferences();
      }

      function switchChart(chartType) {
        // Update active tab
        document.querySelectorAll(".chart-tab").forEach((tab) => {
          tab.classList.remove("active");
        });
        event.target.classList.add("active");

        // Update chart
        if (currentChart) {
          currentChart.destroy();
        }

        const ctx = document.getElementById("workloadChart").getContext("2d");
        const chartConfig = {
          type:
            chartType === "distribution"
              ? "doughnut"
              : chartType === "timeline"
              ? "line"
              : "bar",
          data: getChartData(chartType),
          options: getChartOptions(chartType),
        };

        currentChart = new Chart(ctx, chartConfig);
      }

      // Achievement System
      function checkAchievements() {
        const newAchievements = [];

        // Search achievements
        if (searchHistory.length >= 5) {
          newAchievements.push({
            id: "explorer",
            title: "ğŸ” Datenforscher",
            description: "Performed 5 different searches",
            icon: "ğŸ”",
          });
        }

        // View achievements
        const uniqueProctors = new Set(
          filteredResults.map((item) => item.proctor)
        );
        if (uniqueProctors.size >= 10) {
          newAchievements.push({
            id: "networker",
            title: "ğŸ‘¥ GroÃŸartiger Netzwerker",
            description: "Discovered 10+ different proctors",
            icon: "ğŸ‘¥",
          });
        }

        // Perfect load achievement
        const perfectLoads = Array.from(uniqueProctors).filter((proctor) => {
          const load = calculateProctorLoad(proctor);
          return load.percentage === 100;
        });

        if (perfectLoads.length >= 3) {
          newAchievements.push({
            id: "perfectionist",
            title: "ğŸ¯ Perfektionist",
            description: "Found 3+ proctors with perfect load",
            icon: "ğŸ¯",
          });
        }

        // Add new achievements
        newAchievements.forEach((achievement) => {
          if (!achievements.find((a) => a.id === achievement.id)) {
            achievements.push(achievement);
            showNotification(
              `ğŸ† Errungenschaft freigeschaltet: ${achievement.title}!`,
              "Erfolg"
            );
          }
        });

        updateAchievementsPanel();
      }

      function updateAchievementsPanel() {
        const achievementsList = document.getElementById("achievementsList");
        if (achievements.length === 0) {
          achievementsList.innerHTML = `
                    <div class="achievement-item">
                        <div class="achievement-icon">ğŸ¯</div>
                        <div class="achievement-content">
                            <div class="achievement-title">Start Exploring!</div>
                            <div class="achievement-desc">Use the search and filters to unlock achievements</div>
                        </div>
                    </div>
                `;
        } else {
          achievementsList.innerHTML = achievements
            .map(
              (achievement) => `
                    <div class="achievement-item">
                        <div class="achievement-icon">${achievement.icon}</div>
                        <div class="achievement-content">
                            <div class="achievement-title">${achievement.title}</div>
                            <div class="achievement-desc">${achievement.description}</div>
                        </div>
                    </div>
                `
            )
            .join("");
        }
      }

      // User Preferences
      function loadUserPreferences() {
        const saved = localStorage.getItem("proctorSchedulePreferences");
        if (saved) {
          userPreferences = JSON.parse(saved);

          // Apply saved view
          if (userPreferences.preferredView) {
            switchView(userPreferences.preferredView);
          }

          // Load search history
          if (userPreferences.searchHistory) {
            searchHistory = userPreferences.searchHistory;
          }

          // Load achievements
          if (userPreferences.achievements) {
            achievements = userPreferences.achievements;
            updateAchievementsPanel();
          }
        }
      }

      function saveUserPreferences() {
        userPreferences.searchHistory = searchHistory;
        userPreferences.achievements = achievements;
        localStorage.setItem(
          "proctorSchedulePreferences",
          JSON.stringify(userPreferences)
        );
      }

      function updateSearchHistory(query) {
        if (query && query.length > 2 && !searchHistory.includes(query)) {
          searchHistory.unshift(query);
          searchHistory = searchHistory.slice(0, 10); // Keep last 10 searches
          saveUserPreferences();
        }
      }

      // Action Functions
      function clearSearch() {
        searchInput.value = "";
        filteredResults = [];

        // Reset all filters
        document.getElementById("labFilter").value = "";
        document.getElementById("dateFilter").value = "";
        document.getElementById("loadFilter").value = "";
        document.getElementById("sessionFilter").value = "";

        showWelcomeMessage();
        updateStatsDashboard(proctorData);
        hideAutocomplete();
        searchInput.focus();
      }

      function exportResults() {
        const resultsContainer = document.querySelector(".results-container");
        const exportBtn = document.getElementById("exportBtn");

        exportBtn.disabled = true;
        exportBtn.innerHTML = "â³ Generating...";

        const options = {
          backgroundColor: "#ffffff",
          scale: 3,
          useCORS: true,
          allowTaint: true,
          logging: false,
          letterRendering: true,
          onclone: function (clonedDoc) {
            // Enhance cloned document for better rendering
            const style = clonedDoc.createElement("style");
            style.textContent = `
                        * {
                            -webkit-font-smoothing: antialiased !important;
                            -moz-osx-font-smoothing: grayscale !important;
                        }
                        .results-container {
                            box-shadow: none !important;
                        }
                    `;
            clonedDoc.head.appendChild(style);
          },
        };

        html2canvas(resultsContainer, options)
          .then((canvas) => {
            const link = document.createElement("a");
            const timestamp = new Date()
              .toISOString()
              .slice(0, 16)
              .replace("T", "_")
              .replace(/:/g, "-");
            const query = searchInput.value.trim() || "schedule";
            link.download = `enhanced_schedule_${query}_${timestamp}.png`;
            link.href = canvas.toDataURL("image/png", 1.0);

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showNotification(
              "ğŸ“¸Hochwertiges Bild erfolgreich exportiert!",
              "Erfolg"
            );

            exportBtn.disabled = false;
            exportBtn.innerHTML = "ğŸ“¸ Export";
          })
          .catch((error) => {
            console.error("Export failed:", error);
            showNotification(
              "âŒ Export fehlgeschlagen. Bitte versuchen Sie es erneut.",
              "Fehler"
            );

            exportBtn.disabled = false;
            exportBtn.innerHTML = "ğŸ“¸ Export";
          });
      }

      function generateReport() {
        const stats = calculateStatistics(filteredResults);
        const reportData = {
          timestamp: new Date().toISOString(),
          query: searchInput.value || "All data",
          totalResults: filteredResults.length,
          statistics: stats,
          topPerformers: getTopPerformers(),
          recommendations: generateRecommendations(),
        };

        const reportText = `
PRÃœFUNGSAUFSICHTSPLAN ANALYSIS REPORT
Generated: ${new Date().toLocaleString()}
Query: ${reportData.query}

OVERVIEW:
- Total Assignments: ${reportData.totalResults}
- Active Proctors: ${stats.totalProctors}
- Active Labs: ${stats.activeLabs}
- Average Load: ${stats.averageLoad}%

TOP PERFORMERS:
${reportData.topPerformers
  .map((p, i) => `${i + 1}. ${p.name} (${p.assignments} Aufsichten)`)
  .join("\n")}

RECOMMENDATIONS:
${reportData.recommendations.join("\n")}

SYSTEM INSIGHTS:
- Load Distribution: ${stats.underloaded} underloaded, ${stats.optimal} optimal
- Coverage Analysis: ${(
          (stats.totalAssignments /
            (stats.totalProctors * CONFIG.REQUIRED_LOAD)) *
          100
        ).toFixed(1)}% of total capacity used
            `.trim();

        const blob = new Blob([reportText], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = `schedule_report_${new Date()
          .toISOString()
          .slice(0, 10)}.txt`;
        link.click();
        URL.revokeObjectURL(url);

        showNotification("ğŸ“‹ Detailed report generated!", "success");
      }

      function getTopPerformers() {
        const proctorCounts = {};
        filteredResults.forEach((item) => {
          if (item.proctor && item.proctor.trim() !== "") {
            proctorCounts[item.proctor] =
              (proctorCounts[item.proctor] || 0) + 1;
          }
        });

        return Object.entries(proctorCounts)
          .sort(([, a], [, b]) => b - a)
          .slice(0, 5)
          .map(([name, assignments]) => ({ name, assignments }));
      }

      function generateRecommendations() {
        const recommendations = [];
        const stats = calculateStatistics(filteredResults);

        if (stats.underloaded > stats.optimal) {
          recommendations.push(
            "â€¢ ErwÃ¤gen Sie eine Neuverteilung der Aufsichten, um die Arbeitsbelastung auszugleichen."
          );
        }

        if (stats.averageLoad < 70) {
          recommendations.push(
            "â€¢ Die Gesamtauslastung der KapazitÃ¤ten ist gering - Gelegenheit zur Optimierung"
          );
        }

        if (stats.activeLabs < 4) {
          recommendations.push(
            "â€¢ ErwÃ¤gen Sie die Nutzung zusÃ¤tzlicher Labs fÃ¼r eine bessere Verteilung"
          );
        }

        if (recommendations.length === 0) {
          recommendations.push(
            "â€¢ Der aktuelle Aufsichtsplan scheint ausgewogen zu sein"
          );
        }

        return recommendations;
      }

      function exportToCSV() {
        const headers = [
          "Proctor",
          "Lab",
          "Date",
          "Session",
          "Load_Percentage",
          "Load_Status",
        ];
        const csvData = [headers.join(",")];

        filteredResults.forEach((item) => {
          const load = calculateProctorLoad(item.proctor);
          const row = [
            `"${item.proctor}"`,
            `"${item.lab}"`,
            `"${item.date}"`,
            `"${item.session}"`,
            Math.round(load.percentage),
            `"${load.statusText}"`,
          ];
          csvData.push(row.join(","));
        });

        const blob = new Blob([csvData.join("\n")], { type: "text/csv" });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = `schedule_data_${new Date()
          .toISOString()
          .slice(0, 10)}.csv`;
        link.click();
        URL.revokeObjectURL(url);

        showNotification("ğŸ“„ CSV-Daten erfolgreich exportiert!", "Erfolg");
      }

      function printSchedule() {
        const printWindow = window.open("", "_blank");
        const printContent = `
                <html>
                <head>
                    <title>Aufsichtsplan</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .stats { display: flex; justify-content: space-around; margin-bottom: 30px; }
                        .stat { text-align: center; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ğŸ“ PrÃ¼fungsaufsichtsplan</h1>
                        <p>Generated: ${new Date().toLocaleString()}</p>
                        <p>Query: ${
                          searchInput.value || "Complete Schedule"
                        }</p>
                    </div>
                    
                    <div class="stats">
                        <div class="stat">
                            <strong>${filteredResults.length}</strong><br>
                            Total Assignments
                        </div>
                        <div class="stat">
                            <strong>${
                              new Set(filteredResults.map((i) => i.proctor))
                                .size
                            }</strong><br>
                            Active Proctors
                        </div>
                        <div class="stat">
                            <strong>${
                              new Set(filteredResults.map((i) => i.lab)).size
                            }</strong><br>
                            Active Labs
                        </div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Proctor</th>
                                <th>Lab</th>
                                <th>Date</th>
                                <th>Session</th>
                                <th>Load</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredResults
                              .map((item) => {
                                const load = calculateProctorLoad(item.proctor);
                                return `
                                    <tr>
                                        <td>${item.proctor}</td>
                                        <td>${item.lab}</td>
                                        <td>${item.date}</td>
                                        <td>${item.session}</td>
                                        <td>${Math.round(load.percentage)}%</td>
                                    </tr>
                                `;
                              })
                              .join("")}
                        </tbody>
                    </table>
                </body>
                </html>
            `;

        printWindow.document.write(printContent);
        printWindow.document.close();

        setTimeout(() => {
          printWindow.print();
        }, 250);
      }

      function sortTable(column) {
        // Implementation for table sorting
        const table = document.querySelector(".results-table");
        if (!table) return;

        // Add sorting logic here
        showNotification(`ğŸ”„ Sorted by ${column}`, "success");
      }

      function toggleAchievements() {
        const panel = document.getElementById("achievementsPanel");
        panel.classList.toggle("open");
      }

      function showQuickHelp() {
        const helpText = `
ğŸš€ SCHNELLHILFE-LEITFADEN

ğŸ“¸ EXPORT-OPTIONEN:
â€¢ Export: Hochwertiges Bild der aktuellen Ansicht
â€¢ Bericht: Detaillierte Textanalyse
â€¢ CSV: Rohdaten fÃ¼r externe Tools
â€¢ Drucken: Druckoptimiertes Format

ğŸ“Š ANSICHTEN:
â€¢ Karten: Detaillierte Informationen zur Aufsicht mit Arbeitsauslastung
â€¢ Tabelle: Sortierbare Daten im Tabellenformat
â€¢ Zeitplan: Chronologische Ãœbersicht

ğŸ” SUCHTIPS:
â€¢ Gib Namen der Aufsichtspersonen, Labore oder Daten ein
â€¢ Nutze "...", um den vollstÃ¤ndigen Zeitplan zu sehen
â€¢ Probiere TeilÃ¼bereinstimmungen (z.B. "OAD" oder "M121")

ğŸ›ï¸ FILTER:
â€¢ Kombiniere mehrere Filter fÃ¼r prÃ¤zise Ergebnisse
â€¢ Ladestatus: Niedrig (<40%), Mittel (40-70%), Hoch (70-100%), VollstÃ¤ndig (100%+)

ğŸ—“ï¸ VERFÃœGBARE FINDEN:
â€¢ WÃ¤hle einen Zeitpunkt aus dem neuen Panel am Seitenende.
â€¢ Klicke auf "VerfÃ¼gbare finden", um eine Liste aller unbesetzten Aufsichtspersonen fÃ¼r diesen Slot zu erhalten.

ğŸ† ERFOLGE:
â€¢ Entdecke verschiedene Suchanfragen, um Belohnungen freizuschalten
â€¢ Ã–ffne das Erfolgs-Panel (TrophÃ¤en-Symbol)

âŒ¨ï¸ TASTENKÃœRZEL:
â€¢ Enter: Suche ausfÃ¼hren
â€¢ Esc: Suche zurÃ¼cksetzen/Panels schlieÃŸen
            `;

        alert(helpText);
      }

      function showNotification(message, type = "success") {
        const notification = document.getElementById("notification");
        if (!notification) return; // Guard clause
        const text = document.getElementById("notificationText");

        text.textContent = message;
        notification.className = `notification ${type} show`;

        setTimeout(() => {
          notification.classList.remove("show");
        }, 4000);
      }

      // --- START: NEW FUNCTIONS FOR FREE PROCTOR FINDER ---

      /**
       * Initializes the free proctor finder feature by populating the time selector.
       */
      function initializeFreeProctorFinder() {
        const timeSlots = [
          ...new Set(proctorData.map((item) => item.date).filter(Boolean)),
        ].sort();
        populateFilter("freeTimeSelector", timeSlots);
      }

      /**
       * Finds and displays proctors who are not assigned at the selected time.
       */
      function findAndDisplayFreeProctors() {
        const selectedTime = freeTimeSelector.value;

        if (!selectedTime) {
          freeProctorsResult.style.display = "block";
          freeProctorsResult.innerHTML = `<p style="color: var(--error); text-align: center; padding: 20px 0;">Bitte wÃ¤hlen Sie zuerst einen Zeitpunkt aus.</p>`;
          return;
        }

        // 1. Get a unique list of all proctors
        const allProctors = [
          ...new Set(proctorData.map((item) => item.proctor).filter(Boolean)),
        ];

        // 2. Get a list of proctors who are busy at the selected time
        const busyProctors = new Set(
          proctorData
            .filter((item) => item.date === selectedTime && item.proctor)
            .map((item) => item.proctor)
        );

        // 3. Determine who is free by filtering the 'allProctors' list
        const freeProctors = allProctors.filter(
          (proctor) => !busyProctors.has(proctor)
        );

        // 4. Display the results
        let html = `<h3>VerfÃ¼gbare Aufsichtspersonen fÃ¼r ${selectedTime}</h3>`;
        if (freeProctors.length > 0) {
          html += '<ul class="free-proctor-list">';
          freeProctors.forEach((proctor) => {
            html += `<li class="free-proctor-item">${proctor}</li>`;
          });
          html += "</ul>";
        } else {
          html +=
            '<p style="text-align: center; padding: 20px 0;">Alle Aufsichtspersonen sind zu diesem Zeitpunkt entweder beschÃ¤ftigt oder es wurden keine freien Personen gefunden.</p>';
        }

        freeProctorsResult.innerHTML = html;
        freeProctorsResult.style.display = "block";
      }

      // --- END: NEW FUNCTIONS FOR FREE PROCTOR FINDER ---

      // Keyboard shortcuts
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          hideAutocomplete();
          const panel = document.getElementById("achievementsPanel");
          if (panel.classList.contains("open")) {
            panel.classList.remove("open");
          }
        }
      });

      // Initialize welcome state
      showWelcomeMessage();
      (() => {
        const themeToggle = document.getElementById("theme-toggle");
        // We need to get the chart instance later, so we will look for it when needed
        let workloadChartInstance = null;

        // Function to apply the theme (light or dark)
        const applyTheme = (theme) => {
          const isDark = theme === "dark";
          document.body.classList.toggle("dark-mode", isDark);

          // Update the chart colors if the chart has been initialized
          if (window.currentChart) {
            updateChartTheme(window.currentChart, theme);
          }
        };

        // Function to update chart colors based on the theme
        const updateChartTheme = (chart, theme) => {
          if (!chart) return;

          const isDark = theme === "dark";
          const textColor = isDark ? "rgba(237, 242, 247, 0.8)" : "#64748b";
          const gridColor = isDark ? "rgba(74, 85, 104, 0.2)" : "#e2e8f0";

          // Update general options
          chart.options.plugins.legend.labels.color = textColor;

          // Update scales if they exist (for bar/line charts)
          if (chart.options.scales) {
            Object.values(chart.options.scales).forEach((scale) => {
              if (scale.ticks) {
                scale.ticks.color = textColor;
              }
              if (scale.grid) {
                scale.grid.color = gridColor;
              }
            });
          }
          chart.update();
        };

        // Event listener for the toggle button
        themeToggle.addEventListener("click", () => {
          const currentTheme = document.body.classList.contains("dark-mode")
            ? "dark"
            : "light";
          const newTheme = currentTheme === "dark" ? "light" : "dark";

          localStorage.setItem("theme", newTheme); // Save the new theme preference
          applyTheme(newTheme);
        });

        // Immediately apply the saved theme on page load
        const savedTheme = localStorage.getItem("theme") || "light"; // Default to light
        applyTheme(savedTheme);

        // Since your chart is initialized later, we override the switchChart function
        // to also apply the theme when a new chart is created.
        const originalSwitchChart = window.switchChart;
        window.switchChart = function (...args) {
          // Call the original function first
          originalSwitchChart.apply(this, args);
          // Now, apply the current theme to the newly created chart
          const currentTheme = document.body.classList.contains("dark-mode")
            ? "dark"
            : "light";
          if (window.currentChart) {
            updateChartTheme(window.currentChart, currentTheme);
          }
        };
      })();
    </script>
  </body>
</html>
